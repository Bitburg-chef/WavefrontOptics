function [lpsf, mpsf, spsf, arcminperpix, polypsf, strehl] = ComputeLMSPSFsFromZernike(wls,T_cones,spd_weight,zcoeffs,measpupilMM,calcpupilMM,nominalFocusWl,sizeOfFieldPixels,sizeOfFieldMM,sceParams)% [lpsf, mpsf, spsf, arcminperpix, monoPSF] = LMSpsfs(data,zernpupilmm,computepupilmm,focuslambdanm,T_cones,spd_weight)%% This routine finds PSFs seen by each cone class under passed spd_weight spectrum.%% Inputs - see comment in ComputePupilFunctionFromZernike for more details.%   wls -               Column vector of wavelengths over which to cone sensitivity and spectrum are specified.%   T_cones -           Cone spectral sensitivities in Psychtoolbox data format.%   spd_weight -        Weighting spectrum as a column vector.%   ... -               See ComputePSFFromZernike for description of remaining arguments.%% Outputs%   lpsf -              Calcuated L cone psf. %   mpsf -              Calcuated M cone psf.                    %   spsf -              Calcuated S cone psf.                    %   arcminperpix -      Arc minutes per pixel for returned psfs.%   polypsf -           Calcuated polychromatic psf. Third dimension of returned matrix indexes wavelength. %   strehl -            Strehl ratio at each wavelength for polypsf.%% See ComputePSFFromZernike.%% 7/13/07   dhb    Made into a callable function, based on code provided by Heidi Hofer.%           dhb    Remove globals, fix case of fft, get rid of some vars we don't care about%           dhb    Don't write files here, optional plot supression.% 7/14/07   dhb    Change name a little.% 12/22/09  dhb    Return monochromatic PSFs as a cell array% 8/21/11   dhb    Update% Handle default argsif (nargin < 10 || isempty(sceParams))    sceParams = [];end% Force wavelengths to column vector formwls = MakeItWls(wls);% Get weighted cone fundamentalssweight=T_cones(3,:).*spd_weight';mweight=T_cones(2,:).*spd_weight';lweight=T_cones(1,:).*spd_weight';% Get psfs for each cone type[polypsf,arcminperpix,strehl,areapix,areapixapod] = ComputePSFFromZernike(zcoeffs,measpupilMM,calcpupilMM,wls,nominalFocusWl,sizeOfFieldPixels,sizeOfFieldMM,sceParams);\lpsf = zeros(size(polypsf(:,:,1)));mpsf = zeros(size(polypsf(:,:,1)));spsf = zeros(size(polypsf(:,:,1)));for wl = 1:wls    lpsf = lpsf + lweight(wl)*polypsf(:,:,wl);     mpsf = mpsf + mweight(wl)*polypsf(:,:,wl);     spsf = spsf + sweight(wl)*polypsf(:,:,wl); end